# 冰火岛
## Microsoft Service
- xmiles\xutuo
- 3232636521tuot

## zentao login
- admin
- 3232636521Tuo_t
- 3232636521TUO_tuo

## MySQL
- 端口3307
- root密码admin
- NAVI-4U46-HW4V-LIET navicat 万能激活

## 天天赚redis数据库字段
- MainDrawCashIndex
  - 主线提现任务index
- NearestEcpmMap20
  - 历史玩家的ecpm变化趋势
- RedPacketCoin
  - 红包币余额
- DrawState
  - 提现记录，1则提现成功过。用于测试无法提现手机的提现标记，完成好友任务
  - 格式：DrawState:userid_openid 1
  - 
    ```redis
    > SET DrawState:820201_okdX355JY3m6q0rFoSpEMcMZMA2Q 1 
    ```
- InviterDrawVideoListMapV1
  - 好友任务标记领取/标记完成
  - 协同次数检查库
- VideoCount
  - 视频观看次数，连同上面的库，检查好友任务的完成进度。
- FirstPassRedBagStatus
  - 首领大红包，提现标记，0表示未提现，1，表示提现
- IdiomLevel
  - 关卡序号
  










```python
def function():
    return 1
```

## jenkins
 - jdk环境得在8-11的区间



## 分层自动化测试方案

### 1.配置层测试
- 根据策划配置表规则，执行配置层测试。
- 保证配置项的变动，都在规则范围内
- 摒除配置层导致的游戏异常
- 可代码实现工具化
- 可持续集成

### 2.接口自动化
- 根据程序提供的接口文档，执行服务层测试。
- 保证主要业务层接口，在线上环境下能保证稳定。
- 在接口出现异常时，能及时反馈项目组。
- 前期工作量大，后期一本万利（程序配合产出接口文档，测试框架化测试代码）
- 可代码实现工具化
- 可持续集成
  
### 3.UI自动化
- 现阶段的游戏环境，导致UI自动化的深入较难开展
  - 难点1：业务主要核心在于广告的观看上，而广告层不在游戏层内，导致广告的关闭难以结局
  - 难点2：业务内，关于成语接龙，点击填字的操作较难统一成一种代码模式（eg：每次都点击哪些地方让游戏通关等。）
- 



### 好友邀请测试点汇总
- 邀请渠道链接（微信）
- 好友识别二维码下载app
- 好友进入游戏，成功绑定好友关系（下载app绑定方式）
- 好友进入游戏，成功绑定好友关系（输入好友码绑定方式）
- 徒弟第一次提现成功，师傅完成邀请任务
- 徒弟完成10次ad观看，师傅完成10次视频任务（师傅提现非现金，红包币）
- 调整奖励完成档数为（调整后续挡位任务全部完成）完成所有任务，提示“已完成所有挡位”。
- ecpm动态获取奖励（平均500-40 ）领取奖励与配置相符合，符合动态获取奖励需求
- 服务器跨天，重置提现次数
- 最大提现次数5次
- 徒弟师傅不能相互绑定。


# 测试内容
- 1、上应用商店相关
  - 1）应用市场的量全部弹隐私弹框，自然量进益智，非自然量进成语游戏；
  - 2）头条渠道自然量，全部弹隐私弹框+进成语游戏；
  - 3）头条渠道投放量，全部弹隐私弹框+进成语游戏
- 2、登录功能
  - 非自然量，进入游戏无登录按钮，设置界面内无退出账号功能
- 3、邀请好友功能优化
  - 被邀请者，界面展示自己看视频，对邀请者的奖励数据
  - 邀请者界面，展示被邀请者的六艺值
  - 奖励由只奖励红包币，调整为可奖励现金
    - 调整均为现金，可提现
  - 二级奖励查看列表，展示到好友主界面
  - 通过动态ecpm获取好友奖励，符合配置内容，低ecpm用户获取奖励为红包币
  
- 4、主线提现引导 - 每次都引导：
  - 3000档位提现引导 
    - 主线内，奖励达到档位后，触发引导弹窗
    - 引导进入提现弹窗内，点击提现，提现成功
  - 多档位提现
    - 触发引导提现后，再次达到新的档位
    - 触发新一轮引导提现，点击提现，提现成功
  - 单次档位引导只弹出一次
    - 触发一次引导提现弹窗后，不点击提现
    - 再次主线领取红包币后，引导不会弹出
- 5、数值优化：
  - 主线游戏奖励 主线提现成功
  - 积分墙奖励 夏哥测试完成
  - 皇榜奖励 提现成功
  - 好友奖励 
    - 好友累计进度正常
    - 好友任务提现正常
  - 摇钱树奖励 提现成功
  - 签到奖励 红包币领取正常
  - 百倍返利 提现成功
  - 平均ecpm算法更新
    - 取20、10、5的平均ecpm，价值高用谁
- 6、AB Test 方案-新用户初始300ecpm，动态调控
  - 1）新用户进入游戏，缓存的第一个视频的ecpm，为玩家真实ecpm（之前是，所有用户默认300，导致前期低价值用户提现过去）
  - 2）如果玩家真实ecpm＜30，则初始ecpm赋值35
  - 3）如果玩家真实ecpm 30~50，则初始ecpm赋值60
  - 4）如果玩家真实ecpm ≥ 50，则初始ecpm = roundup（ecpm / 100 , 0）*100
  - 5）服务器获取Mustang_user_number字段，进行用户分群
  - 6）0~2999(30%)的用户走新的初始ecpm算法，3000~9999还是走原来的数值，默认初始ecpm300
- 7、更新流程优化
- 8、功能测试相关性补充
  - 更多玩法下载链接是否正常
  - ·

## 测试内容
- 1、
  - 3）RedRewardLimit新增字段：
    - logon_ActiveUser：控制活跃用户登录
      - 活跃用户控制登录
    - logon_NeweUser：控制新增用户登录
      - 新用户控制登录
    - logon_ActiveUser_danger：控制活跃用户中，风控用户登录
      - 风控用户控制登录
    - logon_NeweUser_danger：控制新增用户中，风控用户登录
      - 风控用户控制登录
- 2、AB Test-初始888红包币，基于ecpm来动态调控
  - 1）50%用户，第一关通关，初始默认给888红包币
    - 初始用户默认1688红包币
  - 2）50%用户，走如下策略：
      新用户进入游戏，加载成功第一次视频的ecpm，传给服务器
      基于加载到视频的ecpm，调控初始888红包币值：
    - ecpm 0~100，初始1688红包币
      - ab测分组成功，前端显示为 1688 红包币
    - ecpm 100~200，初始2000红包币
      - 1
    - ecpm 200~400，初始2388红包币
      - ab测分组成功，前端显示为 2388 红包币
    - ecpm 400+，初始2688红包币
      - ab测分组成功，前端显示为 2688 红包币
    如果发放初始红包币时，还没加载出广告，则默认给1688红包币

## 测试内容
- 1、AB Test-高价值用户-全部提现功能
  - 1）新用户进入游戏，主线提现界面，默认增加“全部提现_按钮”
    - 测试通过
  - 2）如果新用户首次加载的视频，ecpm ≥100 ：开启全部提现功能”
        如果ecpm ＜ 100，则隐藏“全部提现_按钮”，不开启此功能
     （主线提现界面，两种显示状态，可切换）
    - 验证开启，通过
  - 3）每个开启全部提现的玩家，每天只有一次全部提现机会
    - 测试通过
  - 4）余额满0.3元（3000红包币），
    - 即可全部提现
      - 大于0.3元，全部提现，不影响分段奖励
    - 不足3毛，点全部提现，提示：“余额大于0.3元，即可全部提现！每天只有一次全部提现机会哦！”
      - 验证通过
  - 5）提现时，基于玩家六艺值，决定可提出金额上限
    - 提现金额上限 = rounddown(ecpm/100,0)，向下取整
      - [1, 5]
    - 当计算金额≥5块时，最高只能提出5块
      - 暂时放着
  - 6）余额达到0.3元，点击全部提现时，
    - 弹窗提示：“ 每天只有一次全部提现机会哦！多看视频可以提出更多现金，你确定要现在全部提现吗？”
      - 玩家可以选择“现在提现”：立即全部提现到微信
        - 验证通过
      - 玩家也可以选择“赚取更多现金”：关闭界面
        - 测试通过
  - 7）玩家当日全部提现后，再次点击全部提现，提示：“今日全部提现机会已用完！请明日再来”
    - 第二层验证，先判断是否满足3000红包币提现门槛，后提示提现次数限制弹窗
    - 客户端提示文字丢失
  - 8）当玩家六艺值低于30后，永久性关闭全部提现功能
    - 验证通过，改ecpm数据库后，关闭功能
    - 重新大于30ecpm后，功能依旧关闭
- 2、首领大红包
  - 1）第一关通关后，弹首领大红包界面
    - 测试通过，第一关通过弹出新的界面
  - 2）玩家有两个选项：
    - 看视频直接提现一次
      - 验证通过
    - 不看视频，领红包币（红包币数值同之前逻辑）
      - 功能实现
  - 3）看视频提现逻辑：
    - 基于玩家第一次视频的ecpm
      - ecpm 0~200，提现0.3元
        - 验证通过，客户端暂时没有提现成功弹窗
      - ecpm 200~400，提现0.5元
      - ecpm 400~600，提现0.66元
      - ecpm 600~800，提现0.88元
      - 看完视频后，服务器直接发放现金，客户端走提现成功的逻辑
  - 4）服务器特别注意：玩家提现后，提现金额 *10000，换算成红包币，累加到玩家获得的总红包币数值中；
    - 数据入库成功
- 3、好友系统优化
  - 1）好友入口按钮，红点逻辑：
    - 有新增的好友时，增加红点，打开一次界面后消失
      - 有任务完成才会显示红点，未实现
    - 有奖励可以领取时，增加红点，领取奖励后消失
      - 有任务完成才会显示红点，暂时有问题
  - 2）好友功能推送：
    - 登录时界面推送：存钱罐→签到→积分墙（福利中心）
      调整为：存钱罐→好友→积分墙（福利中心
      - 好友功能成功替换签到功能
- 4、福利中心优化
  - 1）按钮状态颜色优化：
    - 安装_按钮：红色？
      - 橙色背景，文字边框红色
    - 前往_按钮：橙色
      - 橙色验证
    - 前往领奖_按钮：绿色
      - 绿色验证
    - 领奖_按钮：绿色
      - 绿色验证
    - 明日领取_按钮：蓝色
      - 暂时未触发到
  - 2）入口按钮，红点逻辑：
    - 有处于“可安装状态”的任务时，增加红点，安装成功后消失
      - 状态成功，红点的出现状态存在延迟，优化后测试
    - 有处于“可领奖状态”的任务时，增加红点，领奖成功后消失
      - 状态成功，领取成功后，红点消失
    - 有处于“可前往状态”的任务时，增加红点，前往成功后消失
      - 状态成功，但是红点消失逻辑为完成任务状态后才会消失
- 5、事件内容丰富：进一步丰富访客、妻子的对话内容





